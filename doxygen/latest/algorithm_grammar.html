<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>OpenBR: Algorithm Grammar</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="openbr_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenBR
   &#160;<span id="projectnumber">0.5.0</span>
   </div>
   <div id="projectbrief">Open Source Biometric Recognition</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Algorithm Grammar </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>How algorithms are constructed from string descriptions.</p>
<p><b>So you've run <code>scripts/helloWorld.sh</code> and it generally makes sense, except you have no idea what <code>'Open+Cvt(Gray)+Cascade(FrontalFace)+ASEFEyes+Affine(128,128,0.33,0.45)+CvtFloat+PCA(0.95):Dist(L2)'</code> means or how it is executed.</b> Well if this is the case, you've found the right documentation. Let's get started!</p>
<p>In OpenBR an <em>algorithm</em> is a technique for enrolling templates associated with a technique for comparing them. Recall that our ultimate goal is to be able to say how similar two face images are (or two fingerprints, irises, etc.). Instead of storing the entire raw image for comparison, it is common practice to store an optimized representation, or <em>template</em>, of the image for the task at hand. The process of generating this optimized representatation is called <em>template enrollment</em> or <em>template generation</em>. Given two templates, <em>template comparison</em> computes the similarity between them, where the higher values indicate more probable matches and the threshold for determining what constitutes an adaquate match is determined operationally. The goal of template generation is to design templates that are small, accurate, and fast to compare. Ok, you probably knew all of this already, let's move on.</p>
<p>The only way of creating an algorithm in OpenBR is from a text string that describes it. We call this string the <em>algorithm description</em>. The algorithm description is seperated into two parts by a ':', with the left hand side indicating how to generate templates and the right hand side indicating how to compare them. Some algorithms, like <a class="el" href="group__cpp__plugin__sdk.html#cpp_gender_estimation">Gender Estimation</a> and <a class="el" href="group__cpp__plugin__sdk.html#cpp_age_estimation">Age Estimation</a> are <em>classifiers</em> that don't create templates. In these cases, the colon and the template comparison technique can be omitted from the algorithm description.</p>
<p>There are several motivations for mandating that algorithms are defined from these strings, here are the most important:</p><ol type="1">
<li>It ensures good software development practices by forcibly decoupling the development of each step in an algorithm, facilitating the modification of algorithms and the re-use of individual steps.</li>
<li>It spares the creation and maintainance of a lot of very similar header files that would otherwise be needed for each step in an algorithm, observe the abscence of headers in <code>openbr/plugins</code>.</li>
<li>It allows for algorithm parameter tuning without recompiling.</li>
<li>It is completely unambiguous, both the OpenBR interpreter and anyone familiar with the project can understand exactly what your algorithm does just from this description.</li>
</ol>
<p>Let's look at some of the important parts of the code base that make this possible!</p>
<p>In <code>AlgorithmCore::init()</code> in <code>openbr/core/core.cpp</code> you can see the code for splitting the algorithm description at the colon. Shortly thereafter in this function we <em>make</em> the template generation and comparison methods. These make calls are defined in the public <a class="el" href="group__cpp__plugin__sdk.html">C++ Plugin SDK</a> and can also be called from end user code.</p>
<p>Below we discuss some of the source code for <a class="el" href="classbr_1_1Transform.html#a9ed36eda8404dd2e04d3213ec14d5385">br::Transform::make</a> in <code>openbr/openbr_plugin.cpp</code>. Note, <a class="el" href="classbr_1_1Distance.html#aff9d0ab3773d1a544c00b3bea6a5e36d">br::Distance::make</a> is similar in spirit and will not be covered.</p>
<p>One of the first steps when converting the template enrollment description into a <a class="el" href="classbr_1_1Transform.html">br::Transform</a> is to replace the operators, like '+', with their full form: </p><div class="fragment"><div class="line">    { <span class="comment">// Check for use of &#39;+&#39; as shorthand for Pipe(...)</span></div>
<div class="line">        QStringList words = <a class="code" href="namespaceQtUtils.html#a1ca880bb7225e1247b252d8f9d23bda6">parse</a>(str, <span class="charliteral">&#39;+&#39;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (words.size() &gt; 1)</div>
<div class="line">            <span class="keywordflow">return</span> make(<span class="stringliteral">&quot;Pipe([&quot;</span> + words.join(<span class="stringliteral">&quot;,&quot;</span>) + <span class="stringliteral">&quot;])&quot;</span>, parent);</div>
<div class="line">    }</div>
</div><!-- fragment --><p>A pipe (see <a class="el" href="classbr_1_1PipeTransform.html">br::PipeTransform</a> in <code>openbr/plugins/meta.cpp</code>) is the standard way of chaining together multiple steps in series to form more sophisticated algorithms. PipeTransform takes a list of transforms, and <em>projects</em> templates through each transform in order.</p>
<p>After operator expansion, the template enrollment description forms a tree, and the transform is constructed from this description starting recurively starting at the root of the tree: </p><div class="fragment"><div class="line">    Transform *transform = Factory&lt;Transform&gt;::make(<span class="stringliteral">&quot;.&quot;</span> + str);</div>
</div><!-- fragment --><p> At this point we reach arguably the most important code in the entire framework, the <em>object factory</em> in <code>openbr/openbr_plugin.h</code>. The <a class="el" href="structbr_1_1Factory.html">br::Factory</a> class is responsible for constructing an object from a string: </p><div class="fragment"><div class="line">    <span class="keyword">static</span> T *make(<span class="keyword">const</span> File &amp;file)</div>
<div class="line">    {</div>
<div class="line">        QString name = file.get&lt;QString&gt;(<span class="stringliteral">&quot;plugin&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (name.isEmpty()) name = file.suffix();</div>
<div class="line">        <span class="keywordflow">if</span> (!names().contains(name)) {</div>
<div class="line">            <span class="keywordflow">if</span>      (names().contains(<span class="stringliteral">&quot;Empty&quot;</span>) &amp;&amp; name.isEmpty()) name = <span class="stringliteral">&quot;Empty&quot;</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (names().contains(<span class="stringliteral">&quot;Default&quot;</span>))                 name = <span class="stringliteral">&quot;Default&quot;</span>;</div>
<div class="line">            <span class="keywordflow">else</span>    qFatal(<span class="stringliteral">&quot;%s registry does not contain object named: %s&quot;</span>, qPrintable(baseClassName()), qPrintable(name));</div>
<div class="line">        }</div>
<div class="line">        T *<span class="keywordtype">object</span> = registry-&gt;value(name)-&gt;_make();</div>
<div class="line">        <span class="keyword">static_cast&lt;</span>Object*<span class="keyword">&gt;</span>(object)-&gt;init(file);</div>
<div class="line">        <span class="keywordflow">return</span> object;</div>
<div class="line">    }</div>
</div><!-- fragment --><p> Going back to our original example, a <a class="el" href="classbr_1_1PipeTransform.html">br::PipeTransform</a> will be created with <a class="el" href="classbr_1_1OpenTransform.html">br::OpenTransform</a>, <a class="el" href="classbr_1_1CvtTransform.html">br::CvtTransform</a>, <a class="el" href="classbr_1_1CascadeTransform.html">br::CascadeTransform</a>, <a class="el" href="classbr_1_1ASEFEyesTransform.html">br::ASEFEyesTransform</a>, <a class="el" href="classbr_1_1AffineTransform.html">br::AffineTransform</a>, <a class="el" href="classbr_1_1CvtFloatTransform.html">br::CvtFloatTransform</a>, and <a class="el" href="classbr_1_1PCATransform.html">br::PCATransform</a> as its children. If you want all the tedious details about what exactly this algoritm does, then you should read the <a class="el" href="classbr_1_1Transform.html#aa00ddf40a08b7e1f392d3e324bb69c4e">br::Transform::project</a> function implemented by each of these plugins. The brief explanation is that it <em>reads the image from disk, converts it to grayscale, runs the face detector, runs the eye detector on any detected faces, uses the eye locations to normalize the face for rotation and scale, converts to floating point format, and then embeds it in a PCA subspaced trained on face images</em>. If you are familiar with face recognition, you will likely recognize this as the Eigenfaces <a class="el" href="citelist.html#CITEREF_turk1991eigenfaces">[10]</a> algorithm.</p>
<p>As a final note, the Eigenfaces algorithms uses the Euclidean distance (or L2-norm) to compare templates. Since OpenBR expects <em>similarity</em> values when comparing templates, and not <em>distances</em>, <a class="el" href="classbr_1_1DistDistance.html">br::DistDistance</a> will return <em>-log(distance+1)</em> so that larger values indicate more similarity. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Oct 1 2014 13:47:33 for OpenBR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
